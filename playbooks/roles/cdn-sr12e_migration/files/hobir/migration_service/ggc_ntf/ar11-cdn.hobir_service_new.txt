exit all
configure
##L3##
    port 4/1/37
        description "[ext,iv-g=l3global,iv-s=cdn_l3global] L3 Global Server Cache A  - Link 1 of Lag_12 to Level3 Force10  Switch  Slot A/1  Rack_2"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/38
        description "[ext,iv-g=l3global,iv-s=cdn_l3global] L3 Global Server Cache A  - Link 2 of Lag_12  to Level3 Force10 Switch Slot A/2 Rack_2"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/39
        description "[ext,iv-g=l3global,iv-s=cdn_l3global] L3 Global Server Cache B  - Link 1 of Lag_13 to Level3 Force10  Switch  Slot A/1 Rack_3"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/40
        description "[ext,iv-g=l3global,iv-s=cdn_l3global]  L3 Global Server Cache B  -  Link 2 of Lag_13 to Level3 Force10  Switch  Slot A/2 Rack_3"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    lag 12
        description "[ext,iv-g=l3global,iv-s=cdn_l3global] L3 Global Server_A Content - LAG_12 to L3 Force10 Agg Switch Rack_2"
        mode access
        port 4/1/37
        port 4/1/38
        lacp active
        port-threshold 1 action down
        no shutdown
    exit
    lag 13
        description "[ext,iv-g=l3global,iv-s=cdn_l3global] L3 Global Server_B Content - LAG_13 to L3 Force10 Agg Switch Rack_3"
        mode access
        port 4/1/39
        port 4/1/40
        lacp active
        port-threshold 1 action down
        no shutdown
    exit
    service
        customer 12 create
            description "Level3"
        exit
        ies 220501 customer 12 create
            interface "ies220501_cdn-l3global-data_a" create
                description "[ext,iv-g=l3global,iv-s=cdn_l3global] L3 Global Server_ A content L3_Rack_2"
                address 2.127.242.33/27
                cflowd interface
                ipv6
                    address 2A02:C7A:8000:20A::1/64
                exit
                sap lag-12 create
                exit
            exit
            service-name "ies220501_cdn-l3global-data_a"
            no shutdown
        exit
        ies 220503 customer 12 create
            interface "ies220503_cdn-l3global-data_b" create
                description "[ext,iv-g=l3global,iv-s=cdn_l3global] L3 Global Server_B content L3_Rack_3"
                address 2.127.242.65/27
                cflowd interface
                ipv6
                    address 2A02:C7A:8000:20D::1/64
                exit
                sap lag-13 create
                exit
            exit
            service-name "ies220503_cdn-l3global-data_b"
            no shutdown
        exit
    exit
    router
        policy-options
	    begin
	    prefix-list "CORE-CDN-IPV4-L3-GLOBAL-LAN"
		prefix 2.127.242.32/27 exact
		prefix 2.127.242.64/27 exact
	    exit
	    prefix-list "CORE-CDN-IPV6-L3-GLOBAL-LAN"
		prefix 2A02:C7A:8000:20A::/64 exact
		prefix 2A02:C7A:8000:20D::/64 exact
	    exit
	    community "cdn-hobir-l3-global" members "4589:4" "5607:1005" "4589:14470" "5607:14470" "no-export-subconfed"
	    policy-statement "EXPORT-TO-IBGP"
		entry 28
		    description "Level3 Global LAN subnets"
		    from
			protocol direct
			prefix-list "CORE-CDN-IPV4-L3-GLOBAL-LAN"
		    exit
		    action accept
			community add "cdn-hobir-l3-global"
			metric set 1000
			next-hop-self
		    exit
		exit
	    exit
	    policy-statement "EXPORT-TO-IBGP6"
		entry 299
		    from
			protocol direct
			prefix-list "CORE-CDN-IPV6-L3-GLOBAL-LAN"
		    exit
		    to
			protocol bgp
		    exit
		    action accept
			community add "cdn-hobir-l3-global"
			next-hop-self
		    exit
		exit
	    exit
	    commit
	exit
    exit
##GGC##
    port 4/1/17
        description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google server A"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/18
        description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google server B"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/19
        description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google server C"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/20
        description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google server D"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/21
        description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google server E"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/22
        description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google server F"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/23
        description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google server G"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/24
        description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google server H"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/29
        description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google server I"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/30
        description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google server J"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/31
        description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google server K"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/32
        description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google server L"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/33
        description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google server M"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/34
        description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google server N"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/35
        description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google server O"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/36
        description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google server P"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    service
        customer 16 create
            description "Google GGC"
        exit
        ies 220102 customer 16 create
            interface "ies220102_ggc-datafarm-a_1" create
                description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google GGC Data Farm A"
                address 2.127.251.65/26
                cflowd interface
                ipv6
                    address 2A02:C7A:8000:205::1/64
                exit
                vpls "vpls220105_cdn-ggc-data_a"
                exit
            exit
            service-name "ies220102_ggc-datafarm-a"
            no shutdown
        exit
        ies 220103 customer 16 create
            interface "ies220103_ggc-datafarm-b_1" create
                description "[ext,iv-g=ggc,iv-s=cdn_ggc] Google GGC Data Farm B"
                address 2.127.251.129/26
                cflowd interface
                ipv6
                    address 2A02:C7A:8000:206::1/64
                exit
                vpls "vpls220111_cdn-ggc-data_b"
                exit
            exit
            service-name "ies220103_ggc-datafarm-b"
            no shutdown
        exit
        vpls 220105 customer 16 create
            description "Google Servers A-H"
            allow-ip-int-binding
            stp
                shutdown
            exit
            service-name "vpls220105_cdn-ggc-data_a"
            sap 4/1/17 create
            exit
            sap 4/1/18 create
            exit
            sap 4/1/19 create
            exit
            sap 4/1/20 create
            exit
            sap 4/1/21 create
            exit
            sap 4/1/22 create
            exit
            sap 4/1/23 create
            exit
            sap 4/1/24 create
            exit
            no shutdown
        exit
        vpls 220111 customer 16 create
            description "Google Servers I-P"
            allow-ip-int-binding
            stp
                shutdown
            exit
            service-name "vpls220111_cdn-ggc-data_b"
            sap 4/1/29 create
            exit
            sap 4/1/30 create
            exit
            sap 4/1/31 create
            exit
            sap 4/1/32 create
            exit
            sap 4/1/33 create
            exit
            sap 4/1/34 create
            exit
            sap 4/1/35 create
            exit
            sap 4/1/36 create
            exit
            no shutdown
        exit
    exit
    router
        policy-options
            begin
            prefix-list "CORE-CDN-IPV4-GGC-LAN"
                prefix 2.127.251.64/26 exact
                prefix 2.127.251.128/26 exact
            exit
            prefix-list "CORE-CDN-IPV6-GGC-LAN"
                prefix 2A02:C7A:8000:205::/64 exact
                prefix 2A02:C7A:8000:206::/64 exact
            exit
            prefix-list "SKY_SUPERNETS_GOOGLE"
                prefix 5.64.0.0/13 exact
                prefix 90.192.0.0/11 exact
                prefix 90.192.0.0/12 exact
                prefix 94.0.0.0/12 exact
                prefix 94.0.0.0/13 exact
                prefix 176.248.0.0/13 exact
            exit
            prefix-list "SKY_SUPERNETS_GLOBAL"
                prefix 2.120.0.0/13 exact
                prefix 2.216.0.0/13 exact
                prefix 5.64.0.0/13 exact
                prefix 87.80.0.0/15 exact
                prefix 90.192.0.0/11 exact
                prefix 94.0.0.0/12 exact
                prefix 151.224.0.0/13 exact
                prefix 176.24.0.0/14 exact
                prefix 176.248.0.0/13 exact
            exit
            community "cdn-hobir-google" members "4589:4" "5607:1003" "4589:14470" "5607:14470" "no-export-subconfed"
            policy-statement "DENY_SKY_SUPERNETS_TO_RR"
                entry 10
                    description "Deny SKY_SUPERNETS to upstream RR"
                    from
                        protocol static
                        prefix-list "SKY_SUPERNETS_GOOGLE" "SKY_SUPERNETS_GLOBAL"
                    exit
                    action reject
                exit
                entry 20
                    description "Allow everything else to pass to EXPORT-TO-IBGP policy"
                    action next-policy
                    exit
                exit
            exit
            policy-statement "EXPORT-TO-IBGP"
                entry 25
                    description "GGC LAN subnets"
                    from
                        protocol direct
                        prefix-list "CORE-CDN-IPV4-GGC-LAN"
                    exit
                    action accept
                        community add "cdn-hobir-google"
                        metric set 1000
                        next-hop-self
                    exit
                exit
			exit
            policy-statement "EXPORT-TO-IBGP6"
                entry 295
                    from
                        protocol direct
                        prefix-list "CORE-CDN-IPV6-GGC-LAN"
                    exit
                    to
                        protocol bgp
                    exit
                    action accept
                        community add "cdn-hobir-google"
                        next-hop-self
                    exit
		exit
	    exit
	    commit
	exit
        bgp
            group "internal-ipv4"
                export "DENY_SKY_SUPERNETS_TO_RR" "EXPORT-TO-IBGP" "export-vpn"
            exit
	exit
	router-advertisement
            interface "ies220102_ggc-datafarm-a_1"
                prefix 2A02:C7A:8000:205::/64
                exit
                no shutdown
            exit
            interface "ies220103_ggc-datafarm-b_1"
                prefix 2A02:C7A:8000:206::/64
                exit
                no shutdown
            exit
        exit
    exit
##NETFLIX##
    port 4/1/5
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Link 1 of 2 Netflix server D"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/6
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Link 2 of 2 Netflix server D"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/7
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Link 1 of 2 Netflix server E"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/8
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Link 2 of 2 Netflix server E"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/9
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Link 1 of 2 Netflix server F"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/10
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Link 2 of 2 Netflix server F"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/11
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Link 2 of 2 Netflix server B"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/12
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Link 1 of 2 Netflix server C"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/13
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Link 2 of 2 Netflix server C"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/14
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Link 1 of 2 Netflix server A"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/15
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Link 2 of 2 Netflix server A"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    port 4/1/16
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Link 1 of 2 Netflix server B"
        ethernet
            mode access
            mtu 8226
            hold-time up 5
        exit
        no shutdown
    exit
    lag 40
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Netflix server A"
        mode access
        port 4/1/14
        port 4/1/15
	lacp active
        no shutdown
    exit
    lag 41
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Netflix server B"
        mode access
        port 4/1/16
        port 4/1/11
	lacp active
        no shutdown
    exit
    lag 42
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Netflix server C"
        mode access
        port 4/1/12
        port 4/1/13
	lacp active
        no shutdown
    exit
    lag 43
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Netflix server D"
        mode access
        port 4/1/5
        port 4/1/6
	lacp active
        no shutdown
    exit
    lag 44
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Netflix server E"
        mode access
        port 4/1/7
        port 4/1/8
	lacp active
        no shutdown
    exit
    lag 45
        description "[ext,iv-g=netflix,iv-s=cdn_netflix] Netflix server F"
        mode access
        port 4/1/9
        port 4/1/10
	lacp active
        no shutdown
    exit
    service
        customer 27 create
            description "Netflix"
        exit
        ies 220401 customer 27 create
            interface "ies 220401_cdn-netflix" create
                description "[ext,iv-g=netflix,iv-s=cdn_netflix] Netflix A-C Gateway IP"
                address 90.223.194.209/29
                cflowd interface
                ipv6
                    address 2A02:C7A:8000:207::1/64
                exit
                vpls "vpls220402_cdn-netflix"
                exit
            exit
            service-name "ies220401_cdn-netflix"
            no shutdown
        exit
        vpls 220402 customer 27 create
            description "VPLS Interconnect Netflix Servers A-C"
            allow-ip-int-binding
            stp
                shutdown
            exit
            service-name "vpls220402_cdn-netflix"
            sap lag-40 create
            exit
            sap lag-41 create
            exit
            sap lag-42 create
            exit
            no shutdown
        exit
        ies 220411 customer 27 create
            interface "ies220411_cdn-netflix" create
                description "[ext,iv-g=netflix,iv-s=cdn_netflix] Netflix D-F Gateway IP"
                address 90.208.115.1/28
                cflowd interface
                ipv6
                    address 2A02:C7A:8000:211::1/64
                exit
                vpls "vpls220412_cdn-netflix"
                exit
            exit
            service-name "ies220411_cdn-netflix"
            no shutdown
        exit
        vpls 220412 customer 27 create
            description "VPLS Interconnect Netflix Servers D-F"
            allow-ip-int-binding
            stp
                shutdown
            exit
            service-name "vpls220412_cdn-netflix"
            sap lag-43 create
            exit
            sap lag-44 create
            exit
            sap lag-45 create
            exit
            no shutdown
        exit
    exit
    router
        policy-options
            begin
            prefix-list "CORE-CDN-IPV4-NETFLIX-LAN"
                prefix 90.223.194.208/29 exact
                prefix 90.223.115.0/28 exact
            exit
            prefix-list "CORE-CDN-IPV6-NETFLIX-LAN"
                prefix 2A02:C7A:8000:207::/64 exact
                prefix 2A02:C7A:8000:211::/64 exact
            exit
            community "cdn-hobir-netflix" members "4589:4" "5607:1006" "4589:14470" "5607:14470" "no-export-subconfed"
            policy-statement "EXPORT-TO-IBGP"
                entry 24
                    description "NETFLIX LAN subnets"
                    from
                        protocol direct
                        prefix-list "CORE-CDN-IPV4-NETFLIX-LAN"
                    exit
                    action accept
                        community add "cdn-hobir-netflix"
                        metric set 1000
                        next-hop-self
                    exit
                exit
            exit
            policy-statement "EXPORT-TO-IBGP6"
                entry 297
                    from
                        protocol direct
                        prefix-list "CORE-CDN-IPV6-NETFLIX-LAN"
                    exit
                    to
                        protocol bgp
                    exit
                    action accept
                        community add "cdn-hobir-netflix"
                        next-hop-self
                    exit
                exit
	    exit
	    commit
exit all
